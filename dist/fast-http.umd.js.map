{"version":3,"file":"fast-http.umd.js","sources":["../src/utils/util.ts","../src/utils/url.ts","../src/core/xhr.ts","../src/fast-http.ts"],"sourcesContent":["/**\n * util\n *\n * @author GuoBin on 2019-07-27\n */\nimport { Options } from '../options'\n\nconst toString = Object.prototype.toString\n\nexport function isDate(val: any): val is Date {\n    return toString.call(val) === '[object Date]'\n}\n\nexport function isPlainObject(val: any): val is Object {\n    return toString.call(val) === '[object Object]'\n}\n\nexport function mergeOptions(prev: Options, adds: Options): Options {\n    const res: any = {}\n    Object.assign(res, prev)\n    for (let key in adds) {\n        if (adds.hasOwnProperty(key)) {\n            res[key] = (adds as any)[key]\n        }\n    }\n    return res as Options\n}\n\nexport function extend<T, U>(first: T, second: U): T & U {\n    let result = <T & U>{}\n    for (let id in first) {\n        ;(<any>result)[id] = (<any>first)[id]\n    }\n    for (let id in second) {\n        // @ts-ignore\n        if (!result.hasOwnProperty(id)) {\n            ;(<any>result)[id] = (<any>second)[id]\n        }\n    }\n    return result\n}\n","/**\n * url\n *\n * @author GuoBin on 2019-07-27\n */\nimport { isDate, isPlainObject } from './util'\n\nfunction encode(value: string): string {\n    return encodeURIComponent(value)\n        .replace(/%40/g, '@')\n        .replace(/%3A/gi, ':')\n        .replace(/%24/g, '$')\n        .replace(/%2C/gi, ',')\n        .replace(/%20/g, '+')\n        .replace(/%5B/gi, '[')\n        .replace(/%5D/gi, ']')\n}\n\n/**\n * get QueryString\n * @param url\n * @param params\n */\nexport function buildUrl(url: string, params?: any) {\n    if (!params) {\n        return url\n    }\n    const parts: string[] = []\n    Object.keys(params).forEach(key => {\n        const value = params[key]\n        if (value === null || value === 'undefined') {\n            return\n        }\n        let res = []\n        if (Array.isArray(value)) {\n            res = value\n            key += '[]'\n        } else {\n            res = [value]\n        }\n        res.forEach(val => {\n            if (isDate(val)) {\n                val = val.toISOString()\n            } else if (isPlainObject(val)) {\n                val = JSON.stringify(val)\n            }\n            parts.push(`${key}=${val}`)\n        })\n    })\n    const serializedParams = parts.join('&')\n    if (serializedParams) {\n        const markIndex = url.indexOf('#')\n        if (markIndex !== -1) {\n            url = url.slice(0, markIndex)\n        }\n        url += (url.indexOf('?') === -1 ? '?' : '&') + serializedParams\n    }\n    return url\n}\n","import { FastRequestConfig } from '../interface/Http'\nimport { voidFunc } from '../interface/types'\nimport { buildUrl } from '../utils/url'\n\nexport default function xhr(config: FastRequestConfig, progressCallback?: voidFunc): Promise<any> {\n    return new Promise((resolve, reject) => {\n        const { data = null, url, method = 'get', headers } = config\n        const request: XMLHttpRequest = new XMLHttpRequest()\n        request.withCredentials = true\n        for (const key in headers) {\n            if (typeof headers[key] === 'string') {\n                request.setRequestHeader(key, headers[key])\n            } else {\n                throw new Error(`config.headers: ${key} must be string`)\n            }\n        }\n        /**\n         * xhr进度\n         * @param ev\n         */\n        request.onprogress = (ev: ProgressEvent) => {\n            if (progressCallback) {\n                progressCallback(ev)\n            }\n        }\n        /**\n         * 响应状态\n         */\n        request.onreadystatechange = () => {\n            if (request.readyState === 4 && request.status >= 200 && request.status < 400) {\n                if (request.getResponseHeader('content-type') === '') {\n                    resolve(request.responseText)\n                }\n                resolve()\n            } else {\n                reject()\n            }\n        }\n        /**\n         * 取消\n         */\n        request.onabort = () => {}\n        /**\n         * 错误\n         * @param err\n         */\n        request.onerror = (err: ProgressEvent) => {\n            reject(err)\n        }\n        /**\n         * 超时\n         */\n        request.ontimeout = () => {\n            reject('请求超时')\n        }\n        request.open(method.toLocaleUpperCase(), buildUrl(url + '', config.params), true)\n        request.send(data)\n    })\n}\n","/**\n * FastHttp\n */\nimport { FastPromise, FastRequestConfig, Http } from './interface/Http'\nimport { Options } from './options'\nimport xhr from './core/xhr'\n\nexport default class FastHttp implements Http {\n    private _defaultOptions: Options\n    constructor(options?: Options) {\n        this._defaultOptions = options ? options : {}\n    }\n\n    delete(url: string, config?: FastRequestConfig): Promise<FastPromise> {\n        if (config) {\n            config.method = 'delete'\n        } else {\n            config = {\n                method: 'delete'\n            }\n        }\n        return this.request(this._mergeConfig(url, config))\n    }\n\n    get(url: string, config?: FastRequestConfig, options?: Options): Promise<FastPromise> {\n        if (config) {\n            config.method = 'get'\n        } else {\n            config = {\n                method: 'get'\n            }\n        }\n        return this.request(this._mergeConfig(url, config, options))\n    }\n\n    head(url: string, config?: FastRequestConfig): Promise<FastPromise> {\n        if (config) {\n            config.method = 'head'\n            config.data = null\n        } else {\n            config = {\n                method: 'head'\n            }\n        }\n        return this.request(this._mergeConfig(url, config))\n    }\n\n    options(url: string, config?: FastRequestConfig): Promise<FastPromise> {\n        if (config) {\n            config.method = 'options'\n            config.data = null\n        } else {\n            config = {\n                method: 'options'\n            }\n        }\n        return this.request(this._mergeConfig(url, config))\n    }\n\n    patch(url: string, data?: any, config?: FastRequestConfig, options?: Options): Promise<FastPromise> {\n        if (config) {\n            config.method = 'patch'\n        } else {\n            config = {\n                method: 'patch'\n            }\n        }\n        return this.request(this._mergeConfig(url, config, options))\n    }\n\n    post(url: string, data?: any, config?: FastRequestConfig, options?: Options): Promise<FastPromise> {\n        if (config) {\n            config.method = 'post'\n        } else {\n            config = {\n                method: 'post'\n            }\n        }\n        return this.request(this._mergeConfig(url, config, options))\n    }\n\n    put(url: string, data?: any, config?: FastRequestConfig, options?: Options): Promise<FastPromise> {\n        if (config) {\n            config.method = 'put'\n        } else {\n            config = {\n                method: 'put'\n            }\n        }\n        return this.request(this._mergeConfig(url, config, options))\n    }\n\n    request(config: FastRequestConfig, options?: Options): Promise<FastPromise> {\n        return xhr(config).then((res: any) => res as FastPromise)\n    }\n\n    private _mergeConfig(url: string, config?: FastRequestConfig, options?: Options): FastRequestConfig {\n        const res: FastRequestConfig = Object.create(null)\n        if (options) {\n            if (config) {\n                res.url = (options as any).host + config.url + url\n                res.method = config.method\n                res.data = config.data\n                res.params = config.params\n                res.responseType = config.responseType\n                const header = JSON.parse('{}')\n                Object.assign(header, options.header, config.headers)\n                res.headers = header\n            } else {\n                res.url = (options as any).host + url\n                res.method = 'get'\n                res.headers = options.header\n            }\n        } else {\n            if (config) {\n                res.url = config.url + url\n                res.method = config.method\n                res.data = config.data\n                res.params = config.params\n                res.responseType = config.responseType\n                const header = JSON.parse('{}')\n                Object.assign(header, config.headers)\n                res.headers = header\n            } else {\n                res.url = url;\n                res.method = 'get';\n            }\n        }\n        return res as FastRequestConfig\n    }\n}\n"],"names":[],"mappings":"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"}