{"version":3,"file":"fast-http.es5.js","sources":["../src/utils/util.ts","../src/utils/url.ts","../src/core/xhr.ts","../src/fast-http.ts"],"sourcesContent":["/**\n * util\n *\n * @author GuoBin on 2019-07-27\n */\nimport { Options } from '../options'\n\nconst toString = Object.prototype.toString\n\nexport function isDate(val: any): val is Date {\n    return toString.call(val) === '[object Date]'\n}\n\nexport function isPlainObject(val: any): val is Object {\n    return toString.call(val) === '[object Object]'\n}\n\nexport function mergeOptions(prev: Options, adds: Options): Options {\n    const res: any = {}\n    Object.assign(res, prev)\n    for (let key in adds) {\n        if (adds.hasOwnProperty(key)) {\n            res[key] = (adds as any)[key]\n        }\n    }\n    return res as Options\n}\n\nexport function extend<T, U>(first: T, second: U): T & U {\n    let result = <T & U>{}\n    for (let id in first) {\n        ;(<any>result)[id] = (<any>first)[id]\n    }\n    for (let id in second) {\n        // @ts-ignore\n        if (!result.hasOwnProperty(id)) {\n            ;(<any>result)[id] = (<any>second)[id]\n        }\n    }\n    return result\n}\n","/**\n * url\n *\n * @author GuoBin on 2019-07-27\n */\nimport { isDate, isPlainObject } from './util'\n\nfunction encode(value: string): string {\n    return encodeURIComponent(value)\n        .replace(/%40/g, '@')\n        .replace(/%3A/gi, ':')\n        .replace(/%24/g, '$')\n        .replace(/%2C/gi, ',')\n        .replace(/%20/g, '+')\n        .replace(/%5B/gi, '[')\n        .replace(/%5D/gi, ']')\n}\n\n/**\n * get QueryString\n * @param url\n * @param params\n */\nexport function buildUrl(url: string, params?: any) {\n    if (!params) {\n        return url\n    }\n    const parts: string[] = []\n    Object.keys(params).forEach(key => {\n        const value = params[key]\n        if (value === null || value === 'undefined') {\n            return\n        }\n        let res = []\n        if (Array.isArray(value)) {\n            res = value\n            key += '[]'\n        } else {\n            res = [value]\n        }\n        res.forEach(val => {\n            if (isDate(val)) {\n                val = val.toISOString()\n            } else if (isPlainObject(val)) {\n                val = JSON.stringify(val)\n            }\n            parts.push(`${key}=${val}`)\n        })\n    })\n    const serializedParams = parts.join('&')\n    if (serializedParams) {\n        const markIndex = url.indexOf('#')\n        if (markIndex !== -1) {\n            url = url.slice(0, markIndex)\n        }\n        url += (url.indexOf('?') === -1 ? '?' : '&') + serializedParams\n    }\n    return url\n}\n","import { FastRequestConfig } from '../interface/Http'\nimport { voidFunc } from '../interface/types'\nimport { buildUrl } from '../utils/url'\n\nexport default function xhr(config: FastRequestConfig, progressCallback?: voidFunc): Promise<any> {\n    return new Promise((resolve, reject) => {\n        const { data = null, url, method = 'get', headers } = config\n        const request: XMLHttpRequest = new XMLHttpRequest()\n        request.withCredentials = true\n        for (const key in headers) {\n            if (typeof headers[key] === 'string') {\n                request.setRequestHeader(key, headers[key])\n            } else {\n                throw new Error(`config.headers: ${key} must be string`)\n            }\n        }\n        /**\n         * xhr进度\n         * @param ev\n         */\n        request.onprogress = (ev: ProgressEvent) => {\n            if (progressCallback) {\n                progressCallback(ev)\n            }\n        }\n        /**\n         * 响应状态\n         */\n        request.onreadystatechange = () => {\n            if (request.readyState === 4 && request.status >= 200 && request.status < 400) {\n                if (request.getResponseHeader('content-type') === '') {\n                    resolve(request.responseText)\n                }\n                resolve()\n            } else {\n                reject()\n            }\n        }\n        /**\n         * 取消\n         */\n        request.onabort = () => {}\n        /**\n         * 错误\n         * @param err\n         */\n        request.onerror = (err: ProgressEvent) => {\n            reject(err)\n        }\n        /**\n         * 超时\n         */\n        request.ontimeout = () => {\n            reject('请求超时')\n        }\n        request.open(method.toLocaleUpperCase(), buildUrl(url + '', config.params), true)\n        request.send(data)\n    })\n}\n","/**\n * FastHttp\n */\nimport { FastPromise, FastRequestConfig, Http } from './interface/Http'\nimport { Options } from './options'\nimport xhr from './core/xhr'\n\nexport default class FastHttp implements Http {\n    private _defaultOptions: Options\n    constructor(options?: Options) {\n        this._defaultOptions = options ? options : {}\n    }\n\n    delete(url: string, config?: FastRequestConfig): Promise<FastPromise> {\n        if (config) {\n            config.method = 'delete'\n        } else {\n            config = {\n                method: 'delete'\n            }\n        }\n        return this.request(this._mergeConfig(url, config))\n    }\n\n    get(url: string, config?: FastRequestConfig, options?: Options): Promise<FastPromise> {\n        if (config) {\n            config.method = 'get'\n        } else {\n            config = {\n                method: 'get'\n            }\n        }\n        return this.request(this._mergeConfig(url, config, options))\n    }\n\n    head(url: string, config?: FastRequestConfig): Promise<FastPromise> {\n        if (config) {\n            config.method = 'head'\n            config.data = null\n        } else {\n            config = {\n                method: 'head'\n            }\n        }\n        return this.request(this._mergeConfig(url, config))\n    }\n\n    options(url: string, config?: FastRequestConfig): Promise<FastPromise> {\n        if (config) {\n            config.method = 'options'\n            config.data = null\n        } else {\n            config = {\n                method: 'options'\n            }\n        }\n        return this.request(this._mergeConfig(url, config))\n    }\n\n    patch(url: string, data?: any, config?: FastRequestConfig, options?: Options): Promise<FastPromise> {\n        if (config) {\n            config.method = 'patch'\n        } else {\n            config = {\n                method: 'patch'\n            }\n        }\n        return this.request(this._mergeConfig(url, config, options))\n    }\n\n    post(url: string, data?: any, config?: FastRequestConfig, options?: Options): Promise<FastPromise> {\n        if (config) {\n            config.method = 'post'\n        } else {\n            config = {\n                method: 'post'\n            }\n        }\n        return this.request(this._mergeConfig(url, config, options))\n    }\n\n    put(url: string, data?: any, config?: FastRequestConfig, options?: Options): Promise<FastPromise> {\n        if (config) {\n            config.method = 'put'\n        } else {\n            config = {\n                method: 'put'\n            }\n        }\n        return this.request(this._mergeConfig(url, config, options))\n    }\n\n    request(config: FastRequestConfig, options?: Options): Promise<FastPromise> {\n        return xhr(config).then((res: any) => res as FastPromise)\n    }\n\n    private _mergeConfig(url: string, config?: FastRequestConfig, options?: Options): FastRequestConfig {\n        const res: FastRequestConfig = Object.create(null)\n        if (options) {\n            if (config) {\n                res.url = (options as any).host + config.url + url\n                res.method = config.method\n                res.data = config.data\n                res.params = config.params\n                res.responseType = config.responseType\n                const header = JSON.parse('{}')\n                Object.assign(header, options.header, config.headers)\n                res.headers = header\n            } else {\n                res.url = (options as any).host + url\n                res.method = 'get'\n                res.headers = options.header\n            }\n        } else {\n            if (config) {\n                res.url = config.url + url\n                res.method = config.method\n                res.data = config.data\n                res.params = config.params\n                res.responseType = config.responseType\n                const header = JSON.parse('{}')\n                Object.assign(header, config.headers)\n                res.headers = header\n            } else {\n                res.url = url;\n                res.method = 'get';\n            }\n        }\n        return res as FastRequestConfig\n    }\n}\n"],"names":[],"mappings":"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"}